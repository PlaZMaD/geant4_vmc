From d35267de4a9984b55d3689ddc6ed1c28ca950495 Mon Sep 17 00:00:00 2001
From: Philipp Munkes <p.munkes@cern.ch>
Date: Tue, 25 Jul 2017 16:14:45 +0200
Subject: [PATCH] Import patches from ShipSoft

---
 applied_patches.txt                      | 2 ++
 source/event/include/TG4SteppingAction.h | 3 ++-
 source/physics/include/TG4ExtDecayer.h   | 2 ++
 source/physics/src/TG4ExtDecayer.cxx     | 4 ++--
 4 files changed, 8 insertions(+), 3 deletions(-)
 create mode 100644 applied_patches.txt

diff --git a/applied_patches.txt b/applied_patches.txt
new file mode 100644
index 0000000..bfd2041
--- /dev/null
+++ b/applied_patches.txt
@@ -0,0 +1,2 @@
+geant4vmc_neutrino.patch
+geant4_vmc_temp.patch
diff --git a/source/event/include/TG4SteppingAction.h b/source/event/include/TG4SteppingAction.h
index 55c44b8..95cf64a 100755
--- a/source/event/include/TG4SteppingAction.h
+++ b/source/event/include/TG4SteppingAction.h
@@ -158,7 +158,8 @@ inline void TG4SteppingAction::SetLoopVerboseLevel(G4int level) {
 
 inline void TG4SteppingAction::SetMaxNofSteps(G4int number) { 
   /// Set maximum number of steps allowed 
-  fMaxNofSteps = number; 
+  // fMaxNofSteps = number; 
+  std::cout<<"bypass setmaxnoofstep "<<number<<std::endl;
 }
 
 inline void TG4SteppingAction::SetSpecialControls(TG4SpecialControlsV2* specialControls)  { 
diff --git a/source/physics/include/TG4ExtDecayer.h b/source/physics/include/TG4ExtDecayer.h
index a67aac4..9752588 100755
--- a/source/physics/include/TG4ExtDecayer.h
+++ b/source/physics/include/TG4ExtDecayer.h
@@ -46,6 +46,7 @@ class TG4ExtDecayer : public G4VExtDecayer,
     virtual ~TG4ExtDecayer();
 
     virtual G4DecayProducts* ImportDecayProducts(const G4Track& track);
+    virtual void    withNeutrinos() {fWithNeutrinos = true;}
     
   private:
     /// Not implemented
@@ -56,6 +57,7 @@ class TG4ExtDecayer : public G4VExtDecayer,
     TG4ParticlesManager* fParticlesManager;  ///< particles manager 
     TVirtualMCDecayer*   fExternalDecayer;   ///< the external decayer
     TClonesArray*        fDecayProductsArray;///< array of decay products
+    bool    fWithNeutrinos; ///< follow also neutrinos 
 };
 
 #endif //TG4_EXT_DECAYER_H
diff --git a/source/physics/src/TG4ExtDecayer.cxx b/source/physics/src/TG4ExtDecayer.cxx
index 9a01de1..08cebf3 100755
--- a/source/physics/src/TG4ExtDecayer.cxx
+++ b/source/physics/src/TG4ExtDecayer.cxx
@@ -36,7 +36,7 @@ TG4ExtDecayer::TG4ExtDecayer(TVirtualMCDecayer* externalDecayer)
     TG4Verbose("extDecayer"),
     fParticlesManager(TG4ParticlesManager::Instance()),
     fExternalDecayer(externalDecayer),
-    fDecayProductsArray(0)
+    fDecayProductsArray(0),fWithNeutrinos(true)
 {
 /// Standard constructor
 
@@ -108,7 +108,7 @@ G4DecayProducts* TG4ExtDecayer::ImportDecayProducts(const G4Track& track)
     G4int status = particle->GetStatusCode();
     G4int pdg = particle->GetPdgCode();
     if ( status>0 && status<11 && 
-         abs(pdg)!=12 && abs(pdg)!=14 && abs(pdg)!=16 ) {
+        ( (abs(pdg)!=12 && abs(pdg)!=14 && abs(pdg)!=16) || fWithNeutrinos) ) {
       // pass to tracking final particles only;
       // skip neutrinos
 
-- 
2.9.3

